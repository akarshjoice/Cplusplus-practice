import tkinter as tk
from tkinter import ttk

class FixClientSimulator(tk.Frame):
    def __init__(self, master=None):
        super().__init__(master)
        self.master = master
        master.title("FIX Client Simulator")

        # Notebook for multiple sessions
        self.notebook = ttk.Notebook(self.master)
        self.notebook.pack(fill="both", expand=True)

        # Menu bar
        self.setup_menu()

        # Session tracking
        self.sessions = {}

    def setup_menu(self):
        """Creates the menu bar."""
        menubar = tk.Menu(self.master)
        self.master.config(menu=menubar)

        session_menu = tk.Menu(menubar, tearoff=0)
        menubar.add_cascade(label="Session", menu=session_menu)
        session_menu.add_command(label="Add New Session", command=self.add_new_session)
        session_menu.add_command(label="Disconnect Session", command=self.disconnect_session)
        session_menu.add_command(label="Reconnect Session", command=self.reconnect_session)

    def add_new_session(self):
        """Opens a dialog to get session name and user info."""
        session_name = f"Session {len(self.notebook.tabs()) + 1}"  # Auto-generate a name
        self.create_session_tab(session_name)

    def create_session_tab(self, session_name):
        """Creates a new tab with session tracking."""
        session_frame = ttk.Frame(self.notebook)
        tab_id = self.notebook.index("end")
        self.notebook.add(session_frame, text=session_name)  # Default text, no color yet

        # Store session state (Connected by default)
        self.sessions[tab_id] = {"name": session_name, "status": "Connected"}

        ttk.Label(session_frame, text=f"Session: {session_name}", font=("Arial", 10)).pack(anchor="w", padx=10, pady=5)

        # Update the tab text color based on the session status
        self.update_tab_style(tab_id)

    def disconnect_session(self):
        """Marks the selected session as disconnected and updates tab text and color."""
        tab_id = self.notebook.index(self.notebook.select())  # Get selected tab index
        if tab_id in self.sessions:
            self.sessions[tab_id]["status"] = "Disconnected"
            session_name = self.sessions[tab_id]["name"]
            self.sessions[tab_id]["frame"].config(bg="red")  # Change frame color to red for disconnected
            self.notebook.tab(tab_id, text=f"{session_name} (Disconnected)")  # Update tab text
            self.update_tab_style(tab_id)

    def reconnect_session(self):
        """Marks the selected session as connected and updates tab text and color."""
        tab_id = self.notebook.index(self.notebook.select())  # Get selected tab index
        if tab_id in self.sessions:
            self.sessions[tab_id]["status"] = "Connected"
            session_name = self.sessions[tab_id]["name"]
            self.sessions[tab_id]["frame"].config(bg="green")  # Change frame color to green for connected
            self.notebook.tab(tab_id, text=session_name)  # Update tab text
            self.update_tab_style(tab_id)

    def update_tab_style(self, tab_id):
        """Updates tab text color based on session status."""
        if tab_id in self.sessions:
            session_status = self.sessions[tab_id]["status"]
            if session_status == "Connected":
                self.notebook.tab(tab_id, style="TNotebook.Tab")  # Default style
            elif session_status == "Disconnected":
                self.notebook.tab(tab_id, style="TNotebook.Tab")  # You can change style, or keep default

if __name__ == "__main__":
    root = tk.Tk()
    app = FixClientSimulator(master=root)
    app.pack(fill="both", expand=True)
    root.mainloop()
